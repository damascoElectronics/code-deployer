services:
  # OGS Data Generator - Simulador del proveedor externo
  ogs-data-generator:
    image: ogs_data_generator:latest
    container_name: ogs_data_generator
    ports:
      - "5000:5000"
    environment:
      - OGS_ID=OGS-001
      - SATELLITE_ID=SAT-Alpha-01
      - HOST=0.0.0.0
      - PORT=5000
      - UPDATE_INTERVAL=5
    networks:
      - ogs_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

  # Log Collector - Empaquetador de datos
  log-collector:
    image: log_collector:latest
    container_name: log_collector
    ports:
      - "8080:8080"
    environment:
      - OGS_PROVIDER_URL=http://ogs-data-generator:5000
      - FETCH_INTERVAL=10
      - FETCH_TIMEOUT=5
      - DATA_DIR=/app/collected_data
      - HTTP_SERVER_PORT=8080
    volumes:
      - collected_data:/app/collected_data
    networks:
      - ogs_network
    depends_on:
      - ogs-data-generator
    restart: unless-stopped

networks:
  ogs_network:
    driver: bridge

volumes:
  collected_data: