version: '3.8'

services:
  # OGS Data Generator - Simulador del proveedor externo
  ogs-data-generator:
    build:
      context: ./ogs_data_generator
      dockerfile: Dockerfile
    container_name: ogs_data_generator
    ports:
      - "5000:5000"  # Accesible en 192.168.0.11:5000
    environment:
      - OGS_ID=OGS-001
      - SATELLITE_ID=SAT-Alpha-01
      - HOST=0.0.0.0
      - PORT=5000
      - UPDATE_INTERVAL=5
    networks:
      - ogs_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

  # Log Collector - Empaquetador de datos
  log-collector:
    build:
      context: ./log_collector
      dockerfile: Dockerfile
    container_name: log_collector
    ports:
      - "8080:8080"  # Accesible en 192.168.0.11:8080
    environment:
      - OGS_PROVIDER_URL=http://ogs-data-generator:5000
      - FETCH_INTERVAL=10
      - FETCH_TIMEOUT=5
      - DATA_DIR=/app/collected_data
      - HTTP_SERVER_PORT=8080
    volumes:
      - ./data/collected_data:/app/collected_data
    networks:
      - ogs_network
    depends_on:
      - ogs-data-generator
    restart: unless-stopped

networks:
  ogs_network:
    driver: bridge

volumes:
  collected_data: